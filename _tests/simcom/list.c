/* 
 * File:   list.c
 * Author: jtrodriguez
 *
 * Created on 26 de febrero de 2021, 9:20
 */

/* ************************************************************************** */
/* ************************************************************************** */
/* Section: Included Files                                                    */
/* ************************************************************************** */
/* ************************************************************************** */
#include <stdlib.h>
#include <stdint.h>
#include <string.h>

#include "list.h"

/* ************************************************************************** */
/* ************************************************************************** */
/* Section: Constants                                                         */
/* ************************************************************************** */
/* ************************************************************************** */


/* ************************************************************************** */
/* ************************************************************************** */
/* Section: Data types & Definitions                                          */
/* ************************************************************************** */
/* ************************************************************************** */


/* ************************************************************************** */
/* ************************************************************************** */
/* Section: Global data & variables                                           */
/* ************************************************************************** */
/* ************************************************************************** */


/* ************************************************************************** */
/* ************************************************************************** */
/* Section: Callback Functions                                                */
/* ************************************************************************** */
/* ************************************************************************** */


/* ************************************************************************** */
/* ************************************************************************** */
/* Section: Local Functions                                                   */
/* ************************************************************************** */
/* ************************************************************************** */


/* ************************************************************************** */
/* ************************************************************************** */
/* Section: Interface Functions                                               */
/* ************************************************************************** */
/* ************************************************************************** */
t_LIST_NODE *list_create_node (void *data, size_t dataBytesSize)
{
  t_LIST_NODE *n;

  n = (t_LIST_NODE*) malloc (sizeof (t_LIST_NODE));
  if (n)
    {
      n->size = dataBytesSize;
      n->data = (void*) calloc (n->size, sizeof(uint8_t));
      if (n->data)
        {
          if(data) memcpy (n->data, data, n->size);
          n->sig = NULL;
        }
      else
        {
          free (n);
          n = NULL;
        }
    }

  return n;
}

int32_t list_push_node (t_LIST_NODE **list, t_LIST_NODE *node)
{
  t_LIST_NODE *pl;

  if (*list)
    {
      pl = *list;
      while (pl->sig) pl = pl->sig;
      pl->sig = node;
    }
  else
    {
      *list = node;
    }

  return 0;
}

t_LIST_NODE *list_pull_node (t_LIST_NODE **list)
{
  t_LIST_NODE *n = NULL;

  if (*list)
    {
      n = *list;
      *list = (*list)->sig;
    }

  return n;
}

int32_t list_free_node (t_LIST_NODE **node)
{
  if (*node)
    {
      if ((*node)->data)
        {
          free ((*node)->data);
        }
      free (*node);
      *node = NULL;
    }

  return 0;
}

// Operaciones compuestas
int32_t list_add_data(t_LIST_NODE **list, void *data, size_t dataSize)
{
  t_LIST_NODE *nodeAux;
  int32_t err = -1;
  
  nodeAux = list_create_node (data, dataSize);
  if(nodeAux)
    {
      err = 0;
      list_push_node (list, nodeAux);
    }
  return err;
}

int32_t list_delete (t_LIST_NODE **list)
{
  t_LIST_NODE *node;
  while(*list)
    {
      node = *list;
      *list = (*list)->sig;
      list_free_node (&node);
    }
  return 0;
}

/* ************************************************************** End of File */
