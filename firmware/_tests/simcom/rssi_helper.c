/* 
 * File:   rssi_helper.c
 * Author: jtrodriguez
 *
 * Created on 2 de marzo de 2021, 17:02
 */

/* ************************************************************************** */
/* ************************************************************************** */
/* Section: Included Files                                                    */
/* ************************************************************************** */
/* ************************************************************************** */
#include <stdint.h>

#include "rssi_helper.h"

/* ************************************************************************** */
/* ************************************************************************** */
/* Section: Constants                                                         */
/* ************************************************************************** */
/* ************************************************************************** */


/* ************************************************************************** */
/* ************************************************************************** */
/* Section: Data types & Definitions                                          */
/* ************************************************************************** */
/* ************************************************************************** */


/* ************************************************************************** */
/* ************************************************************************** */
/* Section: Global data & variables                                           */
/* ************************************************************************** */
/* ************************************************************************** */


/* ************************************************************************** */
/* ************************************************************************** */
/* Section: Callback Functions                                                */
/* ************************************************************************** */
/* ************************************************************************** */


/* ************************************************************************** */
/* ************************************************************************** */
/* Section: Local Functions                                                   */
/* ************************************************************************** */
/* ************************************************************************** */


/* ************************************************************************** */
/* ************************************************************************** */
/* Section: Interface Functions                                               */
/* ************************************************************************** */

/* ************************************************************************** */
int32_t rssi_get_dbm (int32_t rssi)
{
  int32_t dbm;
  
  switch (rssi)
    {
    case 0:
      dbm = -113; // -113 dBm or less
      break;
    case 1:
      dbm = -111;
      break;
    case 2 ... 30:
      dbm = ((rssi - 2) * 2) - 109; // 2...30 -> -109... -53 dBm
      break;
    case 31:
      dbm = -51; // -51 dBm or greater
      break;
    case 100: dbm = -116; // -116 dBm or less
      break;
    case 101: dbm = -115;
      break;
    case 102 ... 190:
      dbm = rssi - 216; // 102...190 -> -114... -26dBm
      break;
    case 191: dbm = -25; // -25 dBm or greater
      break;
    case 99:
    case 199: dbm = 0;
      break; //not known or not detectable
    default:
      dbm = 1; //Nu se
      break;
    }
  
  return dbm;
}

/* ************************************************************** End of File */
